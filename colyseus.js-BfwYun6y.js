import{c as e,u as t}from"./@colyseus-BMtxoHVo.js";import{b as n}from"./ws-DLAd0t_s.js";import{r as s}from"./httpie-DElu5tJI.js";var i={};ArrayBuffer.isView||(ArrayBuffer.isView=e=>null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var o={},r={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.ServerError=e.CloseCode=void 0,(t=e.CloseCode||(e.CloseCode={}))[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART";class n extends Error{constructor(e,t){super(t),this.name="ServerError",this.code=e}}e.ServerError=n}(r);var a={},h={};function c(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}Object.defineProperty(h,"__esModule",{value:!0}),h.decode=h.encode=void 0,c.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},c.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},c.prototype._str=function(e){var t=function(e,t,n){for(var s="",i=0,o=t,r=t+n;o<r;o++){var a=e.getUint8(o);if(128&a)if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(i=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|63&e.getUint8(++o))>=65536?(i-=65536,s+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):s+=String.fromCharCode(i)}else s+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|63&e.getUint8(++o));else s+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else s+=String.fromCharCode(a)}return s}(this._view,this._offset,e);return this._offset+=e,t},c.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},c.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,s=0,i=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,-1===s){var r=this._view.getUint32(this._offset);return i=this._view.getInt32(this._offset+4),o=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*i+o)+r/1e6)}return[s,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,-1===s?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+o)):-1===s?(i=this._view.getUint32(this._offset),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&i)+o)+(i>>>2)/1e6)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},h.decode=function(e,t=0){var n=new c(e,t),s=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return s};function f(e,t,n){for(var s=0,i=0,o=n.length;i<o;i++)(s=n.charCodeAt(i))<128?e.setUint8(t++,s):s<2048?(e.setUint8(t++,192|s>>6),e.setUint8(t++,128|63&s)):s<55296||s>=57344?(e.setUint8(t++,224|s>>12),e.setUint8(t++,128|s>>6&63),e.setUint8(t++,128|63&s)):(i++,s=65536+((1023&s)<<10|1023&n.charCodeAt(i)),e.setUint8(t++,240|s>>18),e.setUint8(t++,128|s>>12&63),e.setUint8(t++,128|s>>6&63),e.setUint8(t++,128|63&s))}function u(e,t,n){var s=typeof n,i=0,o=0,r=0,a=0,h=0,c=0;if("string"===s){if(h=function(e){for(var t=0,n=0,s=0,i=e.length;s<i;s++)(t=e.charCodeAt(s))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}(n),h<32)e.push(160|h),c=1;else if(h<256)e.push(217,h),c=2;else if(h<65536)e.push(218,h>>8,h),c=3;else{if(!(h<4294967296))throw new Error("String too long");e.push(219,h>>24,h>>16,h>>8,h),c=5}return t.push({_str:n,_length:h,_offset:e.length}),c+h}if("number"===s)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(r=n/Math.pow(2,32)|0,a=n>>>0,e.push(207,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):n>=-32?(e.push(n),1):n>=-128?(e.push(208,n),2):n>=-32768?(e.push(209,n>>8,n),3):n>=-2147483648?(e.push(210,n>>24,n>>16,n>>8,n),5):(r=Math.floor(n/Math.pow(2,32)),a=n>>>0,e.push(211,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"===s){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((h=n.length)<16)e.push(144|h),c=1;else if(h<65536)e.push(220,h>>8,h),c=3;else{if(!(h<4294967296))throw new Error("Array too large");e.push(221,h>>24,h>>16,h>>8,h),c=5}for(i=0;i<h;i++)c+=u(e,t,n[i]);return c}if(n instanceof Date){var f=n.getTime(),l=Math.floor(f/1e3),d=1e6*(f-1e3*l);return l>=0&&d>=0&&l<=17179869183?0===d&&l<=4294967295?(e.push(214,255,l>>24,l>>16,l>>8,l),6):(r=l/4294967296,a=4294967295&l,e.push(215,255,d>>22,d>>14,d>>6,r,a>>24,a>>16,a>>8,a),10):(r=Math.floor(l/4294967296),a=l>>>0,e.push(199,12,255,d>>24,d>>16,d>>8,d,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),15)}if(n instanceof ArrayBuffer){if((h=n.byteLength)<256)e.push(196,h),c=2;else if(h<65536)e.push(197,h>>8,h),c=3;else{if(!(h<4294967296))throw new Error("Buffer too large");e.push(198,h>>24,h>>16,h>>8,h),c=5}return t.push({_bin:n,_length:h,_offset:e.length}),c+h}if("function"==typeof n.toJSON)return u(e,t,n.toJSON());var v=[],_="",p=Object.keys(n);for(i=0,o=p.length;i<o;i++)void 0!==n[_=p[i]]&&"function"!=typeof n[_]&&v.push(_);if((h=v.length)<16)e.push(128|h),c=1;else if(h<65536)e.push(222,h>>8,h),c=3;else{if(!(h<4294967296))throw new Error("Object too large");e.push(223,h>>24,h>>16,h>>8,h),c=5}for(i=0;i<h;i++)c+=u(e,t,_=v[i]),c+=u(e,t,n[_]);return c}if("boolean"===s)return e.push(n?195:194),1;if("undefined"===s)return e.push(192),1;if("function"==typeof n.toJSON)return u(e,t,n.toJSON());throw new Error("Could not encode")}h.encode=function(e){var t=[],n=[],s=u(t,n,e),i=new ArrayBuffer(s),o=new DataView(i),r=0,a=0,h=-1;n.length>0&&(h=n[0]._offset);for(var c,l=0,d=0,v=0,_=t.length;v<_;v++)if(o.setUint8(a+v,t[v]),v+1===h){if(l=(c=n[r])._length,d=a+h,c._bin)for(var p=new Uint8Array(c._bin),g=0;g<l;g++)o.setUint8(d+g,p[g]);else c._str?f(o,d,c._str):void 0!==c._float&&o.setFloat64(d,c._float);a+=l,n[++r]&&(h=n[r]._offset)}return i};var l={},d={},v=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const _=v(n),p=globalThis.WebSocket||_.default;d.WebSocketTransport=class{constructor(e){this.events=e}send(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)}connect(e){this.ws=new p(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,t){this.ws.close(e,t)}get isOpen(){return this.ws.readyState===p.OPEN}},Object.defineProperty(l,"__esModule",{value:!0}),l.Connection=void 0;const g=d;l.Connection=class{constructor(){this.events={},this.transport=new g.WebSocketTransport(this.events)}send(e){this.transport.send(e)}connect(e){this.transport.connect(e)}close(e,t){this.transport.close(e,t)}get isOpen(){return this.transport.isOpen}};var w,m,y,b={};w=b,Object.defineProperty(w,"__esModule",{value:!0}),w.utf8Length=w.utf8Read=w.ErrorCode=w.Protocol=void 0,(m=w.Protocol||(w.Protocol={}))[m.HANDSHAKE=9]="HANDSHAKE",m[m.JOIN_ROOM=10]="JOIN_ROOM",m[m.ERROR=11]="ERROR",m[m.LEAVE_ROOM=12]="LEAVE_ROOM",m[m.ROOM_DATA=13]="ROOM_DATA",m[m.ROOM_STATE=14]="ROOM_STATE",m[m.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",m[m.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",m[m.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES",(y=w.ErrorCode||(w.ErrorCode={}))[y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",y[y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",y[y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",y[y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",y[y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",y[y.AUTH_FAILED=4215]="AUTH_FAILED",y[y.APPLICATION_ERROR=4216]="APPLICATION_ERROR",w.utf8Read=function(e,t){const n=e[t++];for(var s="",i=0,o=t,r=t+n;o<r;o++){var a=e[o];if(128&a)if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(i=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|63&e[++o])>=65536?(i-=65536,s+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):s+=String.fromCharCode(i)}else s+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|63&e[++o]);else s+=String.fromCharCode((31&a)<<6|63&e[++o]);else s+=String.fromCharCode(a)}return s},w.utf8Length=function(e=""){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n+1};var E={};Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const O={};E.registerSerializer=function(e,t){O[e]=t},E.getSerializer=function(e){const t=O[e];if(!t)throw new Error("missing serializer: "+e);return t};var A={};Object.defineProperty(A,"__esModule",{value:!0}),A.createNanoEvents=void 0;A.createNanoEvents=()=>({emit(e,...t){let n=this.events[e]||[];for(let s=0,i=n.length;s<i;s++)n[s](...t)},events:{},on(e,t){var n;return(null===(n=this.events[e])||void 0===n?void 0:n.push(t))||(this.events[e]=[t]),()=>{var n;this.events[e]=null===(n=this.events[e])||void 0===n?void 0:n.filter((e=>t!==e))}}});var M={};Object.defineProperty(M,"__esModule",{value:!0}),M.createSignal=M.EventEmitter=void 0;class S{constructor(){this.handlers=[]}register(e,t=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach((t=>t.apply(this,e)))}invokeAsync(...e){return Promise.all(this.handlers.map((t=>t.apply(this,e))))}remove(e){const t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}M.EventEmitter=S,M.createSignal=function(){const e=new S;function t(t){return e.register(t,null===this)}return t.once=t=>{const n=function(...s){t.apply(this,s),e.remove(n)};e.register(n)},t.remove=t=>e.remove(t),t.invoke=(...t)=>e.invoke(...t),t.invokeAsync=(...t)=>e.invokeAsync(...t),t.clear=()=>e.clear(),t};var C=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),T=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),R=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&C(t,e,n);return T(t,e),t};Object.defineProperty(a,"__esModule",{value:!0}),a.Room=void 0;const P=R(h),I=l,k=b,U=E,j=A,$=M,D=t,L=r;class H{constructor(e,t){this.onStateChange=(0,$.createSignal)(),this.onError=(0,$.createSignal)(),this.onLeave=(0,$.createSignal)(),this.onJoin=(0,$.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,j.createNanoEvents)(),this.roomId=null,this.name=e,t&&(this.serializer=new((0,U.getSerializer)("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(((e,t)=>{var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,`colyseus.js - onError => (${e}) ${t}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(e,t,n=this){const s=new I.Connection;n.connection=s,s.events.onmessage=H.prototype.onMessageCallback.bind(n),s.events.onclose=function(e){var s;if(!n.hasJoined)return null===(s=console.warn)||void 0===s||s.call(console,`Room connection was closed unexpectedly (${e.code}): ${e.reason}`),void n.onError.invoke(e.code,e.reason);e.code===L.CloseCode.DEVMODE_RESTART&&t?t():(n.onLeave.invoke(e.code),n.destroy())},s.events.onerror=function(e){var t;null===(t=console.warn)||void 0===t||t.call(console,`Room, onError (${e.code}): ${e.reason}`),n.onError.invoke(e.code,e.reason)},s.connect(e)}leave(e=!0){return new Promise((t=>{this.onLeave((e=>t(e))),this.connection?e?this.connection.send([k.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(L.CloseCode.CONSENTED)}))}onMessage(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)}send(e,t){const n=[k.Protocol.ROOM_DATA];let s;if("string"==typeof e?D.encode.string(n,e):D.encode.number(n,e),void 0!==t){const e=P.encode(t);s=new Uint8Array(n.length+e.byteLength),s.set(new Uint8Array(n),0),s.set(new Uint8Array(e),n.length)}else s=new Uint8Array(n);this.connection.send(s.buffer)}sendBytes(e,t){const n=[k.Protocol.ROOM_DATA_BYTES];let s;"string"==typeof e?D.encode.string(n,e):D.encode.number(n,e),s=new Uint8Array(n.length+(t.byteLength||t.length)),s.set(new Uint8Array(n),0),s.set(new Uint8Array(t),n.length),this.connection.send(s.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(e){const t=Array.from(new Uint8Array(e.data)),n=t[0];if(n===k.Protocol.JOIN_ROOM){let e=1;const n=(0,k.utf8Read)(t,e);if(e+=(0,k.utf8Length)(n),this.serializerId=(0,k.utf8Read)(t,e),e+=(0,k.utf8Length)(this.serializerId),!this.serializer){const e=(0,U.getSerializer)(this.serializerId);this.serializer=new e}t.length>e&&this.serializer.handshake&&this.serializer.handshake(t,{offset:e}),this.reconnectionToken=`${this.roomId}:${n}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([k.Protocol.JOIN_ROOM])}else if(n===k.Protocol.ERROR){const e={offset:1},n=D.decode.number(t,e),s=D.decode.string(t,e);this.onError.invoke(n,s)}else if(n===k.Protocol.LEAVE_ROOM)this.leave();else if(n===k.Protocol.ROOM_DATA_SCHEMA){const e={offset:1},n=this.serializer.getState().constructor._context.get(D.decode.number(t,e)),s=new n;s.decode(t,e),this.dispatchMessage(n,s)}else if(n===k.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(n===k.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(n===k.Protocol.ROOM_DATA){const n={offset:1},s=D.decode.stringCheck(t,n)?D.decode.string(t,n):D.decode.number(t,n),i=t.length>n.offset?P.decode(e.data,n.offset):void 0;this.dispatchMessage(s,i)}else if(n===k.Protocol.ROOM_DATA_BYTES){const e={offset:1},n=D.decode.stringCheck(t,e)?D.decode.string(t,e):D.decode.number(t,e);this.dispatchMessage(n,new Uint8Array(t.slice(e.offset)))}}setState(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())}patch(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(e,t){var n;const s=this.getMessageHandlerKey(e);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):null===(n=console.warn)||void 0===n||n.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"function":return`$${e._typeid}`;case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}}a.Room=H;var N={},z=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),B=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),V=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&z(t,e,n);return B(t,e),t};Object.defineProperty(N,"__esModule",{value:!0}),N.HTTP=void 0;const J=r,K=V(s);N.HTTP=class{constructor(e){this.client=e}get(e,t={}){return this.request("get",e,t)}post(e,t={}){return this.request("post",e,t)}del(e,t={}){return this.request("del",e,t)}put(e,t={}){return this.request("put",e,t)}request(e,t,n={}){return K[e](this.client.getHttpEndpoint(t),this.getOptions(n)).catch((e=>{var t;const n=e.statusCode,s=(null===(t=e.data)||void 0===t?void 0:t.error)||e.statusMessage||e.message;if(!n&&!s)throw e;throw new J.ServerError(n,s)}))}getOptions(e){return this.authToken&&(e.headers||(e.headers={}),e.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!=typeof cc&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};var W={},x={};let q;function F(){if(!q)try{q="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(e){}return q||(q={cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),q}Object.defineProperty(x,"__esModule",{value:!0}),x.getItem=x.removeItem=x.setItem=void 0,x.setItem=function(e,t){F().setItem(e,t)},x.removeItem=function(e){F().removeItem(e)},x.getItem=function(e,t){const n=F().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>t(e))):t(n)};var Y,X,G,Q,Z=e&&e.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{h(s.next(e))}catch(t){o(t)}}function a(e){try{h(s.throw(e))}catch(t){o(t)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}h((s=s.apply(e,t||[])).next())}))},ee=e&&e.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},te=e&&e.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(W,"__esModule",{value:!0}),W.Auth=void 0;const ne=x,se=A;W.Auth=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},Y.set(this,!1),X.set(this,void 0),G.set(this,void 0),Q.set(this,(0,se.createNanoEvents)()),(0,ne.getItem)(this.settings.key,(e=>this.token=e))}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const t=ee(this,Q,"f").on("change",e);return ee(this,Y,"f")||te(this,X,new Promise(((e,t)=>{this.getUserData().then((e=>{this.emitChange(Object.assign(Object.assign({},e),{token:this.token}))})).catch((e=>{this.emitChange({user:null,token:void 0})})).finally((()=>{e()}))})),"f"),te(this,Y,!0,"f"),t}getUserData(){return Z(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(e,t,n){return Z(this,void 0,void 0,(function*(){const s=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:t,options:n}})).data;return this.emitChange(s),s}))}signInWithEmailAndPassword(e,t){return Z(this,void 0,void 0,(function*(){const n=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:t}})).data;return this.emitChange(n),n}))}signInAnonymously(e){return Z(this,void 0,void 0,(function*(){const t=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(t),t}))}sendPasswordResetEmail(e){return Z(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data}))}signInWithProvider(e,t={}){return Z(this,void 0,void 0,(function*(){return new Promise(((n,s)=>{const i=t.width||480,o=t.height||768,r=this.token?`?token=${this.token}`:"",a=`Login with ${e[0].toUpperCase()+e.substring(1)}`,h=this.http.client.getHttpEndpoint(`${t.prefix||`${this.settings.path}/provider`}/${e}${r}`),c=screen.width/2-i/2,f=screen.height/2-o/2;te(this,G,window.open(h,a,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+i+", height="+o+", top="+f+", left="+c),"f");const u=e=>{void 0===e.data.user&&void 0===e.data.token||(clearInterval(l),ee(this,G,"f").close(),te(this,G,void 0,"f"),window.removeEventListener("message",u),void 0!==e.data.error?s(e.data.error):(n(e.data),this.emitChange(e.data)))},l=setInterval((()=>{ee(this,G,"f")&&!ee(this,G,"f").closed||(te(this,G,void 0,"f"),s("cancelled"),window.removeEventListener("message",u))}),200);window.addEventListener("message",u)}))}))}signOut(){return Z(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(e){void 0!==e.token&&(this.token=e.token,null===e.token?(0,ne.removeItem)(this.settings.key):(0,ne.setItem)(this.settings.key,e.token)),ee(this,Q,"f").emit("change",e)}},Y=new WeakMap,X=new WeakMap,G=new WeakMap,Q=new WeakMap;var ie={};Object.defineProperty(ie,"__esModule",{value:!0}),ie.discordURLBuilder=void 0,ie.discordURLBuilder=function(e){var t;const n=(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)||"localhost",s=e.hostname.split("."),i=!e.hostname.includes("trycloudflare.com")&&!e.hostname.includes("discordsays.com")&&s.length>2?`/${s[0]}`:"";return e.pathname.startsWith("/.proxy")?`${e.protocol}//${n}${i}${e.pathname}${e.search}`:`${e.protocol}//${n}/.proxy/colyseus${i}${e.pathname}${e.search}`};var oe,re=e&&e.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{h(s.next(e))}catch(t){o(t)}}function a(e){try{h(s.throw(e))}catch(t){o(t)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}h((s=s.apply(e,t||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.Client=o.MatchMakeError=void 0;const ae=r,he=a,ce=N,fe=W,ue=ie;class le extends Error{constructor(e,t){super(e),this.code=t,Object.setPrototypeOf(this,le.prototype)}}o.MatchMakeError=le;const de="undefined"!=typeof window&&void 0!==(null===(oe=null===window||void 0===window?void 0:window.location)||void 0===oe?void 0:oe.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";o.Client=class{constructor(e=de,t){var n,s;if("string"==typeof e){const t=e.startsWith("/")?new URL(e,de):new URL(e),n="https:"===t.protocol||"wss:"===t.protocol,s=Number(t.port||(n?443:80));this.settings={hostname:t.hostname,pathname:t.pathname,port:s,secure:n}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new ce.HTTP(this),this.auth=new fe.Auth(this.http),this.urlBuilder=t,!this.urlBuilder&&"undefined"!=typeof window&&(null===(s=null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)||void 0===s?void 0:s.includes("discordsays.com"))&&(this.urlBuilder=ue.discordURLBuilder)}joinOrCreate(e,t={},n){return re(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",e,t,n)}))}create(e,t={},n){return re(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",e,t,n)}))}join(e,t={},n){return re(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",e,t,n)}))}joinById(e,t={},n){return re(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",e,t,n)}))}reconnect(e,t){return re(this,void 0,void 0,(function*(){if("string"==typeof e&&"string"==typeof t)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[n,s]=e.split(":");if(!n||!s)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",n,{reconnectionToken:s},t)}))}getAvailableRooms(e=""){return re(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${e}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(e,t,n){return re(this,void 0,void 0,(function*(){const s=this.createRoom(e.room.name,t);s.roomId=e.room.roomId,s.sessionId=e.sessionId;const i={sessionId:s.sessionId};e.reconnectionToken&&(i.reconnectionToken=e.reconnectionToken);const o=n||s;return s.connect(this.buildEndpoint(e.room,i),e.devMode&&(()=>re(this,void 0,void 0,(function*(){let n=0;const s=()=>re(this,void 0,void 0,(function*(){n++;try{yield this.consumeSeatReservation(e,t,o)}catch(i){n<8&&setTimeout(s,2e3)}}));setTimeout(s,2e3)}))),o),new Promise(((e,t)=>{const n=(e,n)=>t(new ae.ServerError(e,n));o.onError.once(n),o.onJoin.once((()=>{o.onError.remove(n),e(o)}))}))}))}createMatchMakeRequest(e,t,n={},s,i){return re(this,void 0,void 0,(function*(){const o=(yield this.http.post(`matchmake/${e}/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).data;if(o.error)throw new le(o.error,o.code);return"reconnect"===e&&(o.reconnectionToken=n.reconnectionToken),yield this.consumeSeatReservation(o,s,i)}))}createRoom(e,t){return new he.Room(e,t)}buildEndpoint(e,t={}){const n=[];for(const o in t)t.hasOwnProperty(o)&&n.push(`${o}=${t[o]}`);let s=this.settings.secure?"wss://":"ws://";e.publicAddress?s+=`${e.publicAddress}`:s+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const i=`${s}/${e.processId}/${e.roomId}?${n.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getHttpEndpoint(e=""){const t=e.startsWith("/")?e:`/${e}`,n=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${t}`;return this.urlBuilder?this.urlBuilder(new URL(n)):n}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}};var ve={};Object.defineProperty(ve,"__esModule",{value:!0}),ve.SchemaSerializer=void 0;const _e=t;ve.SchemaSerializer=class{setState(e){return this.state.decode(e)}getState(){return this.state}patch(e){return this.state.decode(e)}teardown(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===t||t.root.clearRefs()}handshake(e,t){if(this.state){(new _e.Reflection).decode(e,t)}else this.state=_e.Reflection.decode(e,t)}};var pe={};Object.defineProperty(pe,"__esModule",{value:!0}),pe.NoneSerializer=void 0;pe.NoneSerializer=class{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SchemaSerializer=e.registerSerializer=e.Auth=e.Room=e.ErrorCode=e.Protocol=e.Client=void 0;var t=o;Object.defineProperty(e,"Client",{enumerable:!0,get:function(){return t.Client}});var n=b;Object.defineProperty(e,"Protocol",{enumerable:!0,get:function(){return n.Protocol}}),Object.defineProperty(e,"ErrorCode",{enumerable:!0,get:function(){return n.ErrorCode}});var s=a;Object.defineProperty(e,"Room",{enumerable:!0,get:function(){return s.Room}});var i=W;Object.defineProperty(e,"Auth",{enumerable:!0,get:function(){return i.Auth}});const r=ve;Object.defineProperty(e,"SchemaSerializer",{enumerable:!0,get:function(){return r.SchemaSerializer}});const h=pe,c=E;Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return c.registerSerializer}}),(0,c.registerSerializer)("schema",r.SchemaSerializer),(0,c.registerSerializer)("none",h.NoneSerializer)}(i);export{i as l};
